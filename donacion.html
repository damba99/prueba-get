<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Prueba Getnet + Flask + SQLite</title>
</head>
<body>
  <h1>游눱 Demo integraci칩n de pagos</h1>

  <p>
    <label for="amount">Monto (centavos ARS):</label>
    <input type="number" id="amount" value="100" />
  </p>

  <!-- Todos los botones tienen type="button" -->
  <button type="button" onclick="getToken()">游댐 /token</button>
  <button type="button" onclick="createPaymentIntent()">游눶 /payment-intent</button>
  <button type="button" onclick="listPayments()">游닆 /payments</button>

  <pre id="output"></pre>
  <div id="checkout-button"></div>

  <script>
    const API = "https://getnet-volviendo-a-casa.onrender.com";

    async function getToken() {
      const res = await fetch(`${API}/token`);
      const data = await res.json();
      show("Respuesta /token", data);
    }

    async function createPaymentIntent() {
      const amount = parseInt(document.getElementById("amount").value);
      const res = await fetch(`${API}/payment-intent`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ amount })
      });
      const data = await res.json();
      show("Respuesta /payment-intent", data);

      const btnContainer = document.getElementById("checkout-button");
      btnContainer.innerHTML = ""; // limpiar

      // Crear bot칩n din치mico
      const button = document.createElement("button");
      button.type = "button";
      button.textContent = data.redirect_url
        ? "游녤 Ir al checkout Getnet"
        : "丘멆잺 No lleg칩 redirect_url";
      if (data.redirect_url) {
        button.onclick = () => window.open(data.redirect_url, "_blank");
      } else {
        button.disabled = true;
      }
      btnContainer.appendChild(button);
    }

    async function listPayments() {
      const res = await fetch(`${API}/payments`);
      const data = await res.json();
      show("Pagos en DB", data);
    }

    function show(title, data) {
      document.getElementById("output").textContent =
        `${title}:\n` + JSON.stringify(data, null, 2);
    }
  </script>
</body>
</html>
